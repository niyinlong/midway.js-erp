# MRP（Manufacturing Resource Planning）模块产品文档

## 1. 模块概述

MRP模块是企业资源规划系统中的核心生产管理模块，负责物料需求计划、生产订单管理、工作中心调度和产能规划等全流程生产管理功能。该模块实现了从产品设计、物料清单管理、生产计划制定到生产执行和成本核算的完整闭环管理。

### 主要功能亮点：
- 多级物料清单(BOM)管理与版本控制
- 生产订单全生命周期跟踪
- 工作中心资源管理与产能规划
- 工单调度与执行进度监控
- 生产损耗与效率分析
- 生产成本核算
- 产品拆解与返工处理

## 2. 实体表结构与功能详解

### 2.1 核心生产管理实体

#### 2.1.1 物料清单 (mrp_bom)

物料清单是定义产品结构的基础，记录了生产一个产品所需的所有原材料、组件及其数量关系。

**关键字段：**
- `product_tmpl_id`：产品模板ID
- `product_id`：产品变体ID
- `product_uom_id`：计量单位ID
- `produce_delay`：制造提前期
- `days_to_prepare_mo`：准备生产订单的天数

**主要功能：**
- 定义产品的组件构成和用量
- 计算生产所需的原材料数量
- 支持产品的生产时间估算
- 与产品管理模块集成

#### 2.1.2 物料清单行 (mrp_bom_line)

记录物料清单中的具体组件信息，定义父级产品与子级组件之间的用量关系。

**关键字段：**
- `bom_id`：所属物料清单ID
- `product_id`：组件产品ID
- `product_uom_id`：组件计量单位ID
- `operation_id`：组件在哪个工序被消耗

**主要功能：**
- 详细记录每个组件的信息和用量
- 支持按工序分配组件
- 实现物料的多级结构管理

#### 2.1.3 生产订单 (mrp_production)

生产订单是执行生产活动的核心文档，包含了制造产品所需的所有信息。

**关键字段：**
- `product_id`：生产产品ID
- `product_uom_id`：产品计量单位ID
- `location_src_id`：原材料来源库位
- `location_dest_id`：成品存放库位
- `production_group_id`：生产组ID

**主要功能：**
- 定义生产任务和目标
- 跟踪生产进度和状态
- 管理原材料的领用和消耗
- 控制成品的入库
- 与库存模块集成实现物料流转

#### 2.1.4 工作中心 (mrp_workcenter)

工作中心是生产活动的物理场所，代表执行特定工艺的设备或生产线。

**关键字段：**
- `resource_id`：资源ID
- `resource_calendar_id`：工作日历ID
- `name`：工作中心名称
- `code`：工作中心编码

**主要功能：**
- 定义生产资源和能力
- 管理工作中心的工作时间
- 支持生产排程和资源分配
- 跟踪工作中心的状态和效率

#### 2.1.5 工单 (mrp_workorder)

工单是生产订单的执行单元，对应于生产过程中的一个具体工序。

**关键字段：**
- `production_id`：所属生产订单ID
- `workcenter_id`：执行工作中心ID
- `operation_id`：工序ID
- `sequence`：工序顺序
- `duration_percent`：持续时间偏差百分比

**主要功能：**
- 详细规划生产过程中的每个工序
- 跟踪每个工序的执行状态
- 计算工序的实际执行时间
- 支持工单的开始、暂停和完成操作

### 2.2 工艺路线与工序管理

#### 2.2.1 工艺路线工作中心 (mrp_routing_workcenter)

定义产品生产过程中的具体工序和工作中心分配。

**关键字段：**
- `bom_id`：物料清单ID
- `workcenter_id`：工作中心ID
- `sequence`：工序顺序
- `time_mode`：工时计算方式
- `cost_mode`：成本计算方式

**主要功能：**
- 定义产品的生产工艺流程
- 指定每个工序使用的工作中心
- 设置工序的时间和成本参数
- 支持工序之间的依赖关系

### 2.3 生产执行与控制

#### 2.3.1 生产拆解单 (mrp_unbuild)

用于将成品拆解为组件，支持返工和回收场景。

**关键字段：**
- `product_id`：要拆解的产品ID
- `bom_id`：拆解使用的物料清单ID
- `mo_id`：关联的生产订单ID
- `lot_id`：批次/序列号ID
- `location_id`：来源库位ID

**主要功能：**
- 管理产品的拆解和返工流程
- 支持按照物料清单回收组件
- 与库存模块集成实现物料的重新入库

#### 2.3.2 工作中心生产力记录 (mrp_workcenter_productivity)

记录工作中心的生产活动和效率数据。

**关键字段：**
- `workcenter_id`：工作中心ID
- `workorder_id`：工单ID
- `user_id`：操作员工ID
- `loss_id`：损耗原因ID
- `description`：描述
- `start_date`：开始时间

**主要功能：**
- 跟踪工作中心的运行状态
- 记录生产过程中的损耗和异常
- 收集生产力和效率数据
- 支持生产成本分析

#### 2.3.3 工作中心产能 (mrp_workcentercapacity)

定义工作中心的产能参数和时间设置。

**关键字段：**
- `workcenter_id`：工作中心ID
- `product_id`：产品ID
- `capacity`：产能
- `time_start`：准备时间(分钟)
- `time_stop`：清理时间(分钟)

**主要功能：**
- 定义工作中心的产能上限
- 设置工序的准备和清理时间
- 支持不同产品的产能参数差异化设置
- 为生产排程提供数据支持

### 2.4 辅助管理实体

#### 2.4.1 生产分组 (mrp_productiongroup)

用于将相关的生产订单分组管理。

#### 2.4.2 工作中心标签 (mrp_workcentertag)

为工作中心添加标签，方便分类和筛选。

#### 2.4.3 生产力损失类型 (mrp_workcenterproductivitylosstype)

定义生产过程中的各种损失类型，用于效率分析。

#### 2.4.4 回单确认 (mrp.accountwipaccounting)

管理生产在制品的会计核算。

#### 2.4.5 消耗警告 (mrp.consumptionwarning)

监控和预警物料消耗异常情况。

## 3. 实体关系图

```
mrp_production (生产订单)
      |
      | 1:n
      v
mrp_workorder (工单) <---- mrp_routing_workcenter (工艺路线工作中心)
      |                           |
      | n:1                       | n:1
      v                           v
mrp_workcenter (工作中心) <---- mrp_workcentercapacity (工作中心产能)
      |
      | 1:n
      v
mrp_workcenterproductivity (工作中心生产力记录)

mrp_bom (物料清单)
      |
      | 1:n
      v
mrp_bom_line (物料清单行)
      |
      | n:1
      v
product (产品)
```

## 4. 主要业务流程

### 4.1 生产计划与执行流程

1. **产品与BOM维护**
   - 创建/维护产品信息
   - 定义物料清单(BOM)和工艺路线
   - 设置工作中心和产能参数

2. **生产订单创建**
   - 根据需求(销售订单、库存预警等)创建生产订单
   - 系统自动根据BOM计算所需物料
   - 指定生产数量、时间和相关参数

3. **生产订单审核**
   - 确认生产计划和物料可用性
   - 审核后自动生成工单

4. **工单执行**
   - 工单分配到工作中心
   - 记录实际开始时间和完成时间
   - 跟踪生产进度和物料消耗

5. **成品入库**
   - 工单完成后进行质量检验
   - 合格产品入库到指定库位
   - 更新库存数量和成本

6. **成本核算**
   - 收集生产过程中的各项成本
   - 计算产品的实际生产成本
   - 生成成本核算报表

### 4.2 产品拆解流程

1. 创建拆解单，指定要拆解的产品和数量
2. 系统根据BOM确定可回收的组件
3. 执行拆解操作，回收组件
4. 组件退回原材料库位
5. 更新相关库存记录

### 4.3 工作中心效率管理流程

1. 工作中心操作员记录开始工作时间
2. 记录生产过程中的正常工作和损耗时间
3. 系统自动计算工作中心效率
4. 生成效率分析报表，识别改进机会

## 5. 特色功能

### 5.1 多级BOM支持
- 支持复杂的产品结构定义
- 支持BOM版本控制和变更管理
- 支持产品变体的BOM差异管理

### 5.2 灵活的工艺路线
- 可定义产品的多道工序和顺序
- 支持工序间的依赖关系
- 可针对不同产品定义不同的工艺路线

### 5.3 智能生产排程
- 基于工作中心产能自动排程
- 考虑工序间的依赖关系
- 支持紧急订单的插单功能

### 5.4 实时生产监控
- 实时跟踪工单执行状态
- 监控物料消耗和异常情况
- 可视化展示生产进度

### 5.5 全面的成本管理
- 记录直接材料、直接人工和制造费用
- 支持标准成本和实际成本对比
- 提供详细的成本分析报告

## 6. 技术实现要点

### 6.1 实体关系设计
- 采用多对多关系表处理复杂关联
- 使用外键约束确保数据完整性
- 支持级联操作和软删除

### 6.2 性能优化
- 对频繁查询的字段建立索引
- 优化复杂查询和统计计算
- 支持数据缓存和批量处理

### 6.3 扩展性设计
- 支持自定义字段和业务流程
- 提供API接口与其他系统集成
- 采用模块化设计便于功能扩展

### 6.4 数据安全
- 基于角色的访问控制
- 敏感数据加密存储
- 完整的操作日志记录

## 7. 总结

MRP模块为企业提供了全面的生产管理解决方案，涵盖了从产品设计、生产计划到执行控制的整个生产生命周期。通过合理的实体设计和业务流程优化，该模块能够帮助企业提高生产效率、降低成本、提升产品质量，实现生产管理的精细化和智能化。