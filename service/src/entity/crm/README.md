# CRM模块产品文档

## 1. 模块概述

CRM（客户关系管理）模块是ERP系统中的核心功能模块，主要负责管理企业与客户之间的互动关系，从线索获取、销售跟进到客户维护的全生命周期管理。该模块通过34个实体表，提供了完整的客户关系管理功能体系，包括线索管理、销售团队管理、销售流程控制、数据分析等核心功能。

## 2. 实体表结构与功能详解

### 2.1 核心业务实体

#### 2.1.1 线索管理 (crm_lead)

**功能描述**：管理潜在客户信息，跟踪从初次接触到转化为客户的整个过程。

**主要字段**：
- `id`: 主键ID，线索的唯一标识符
- `campaign_id`: 营销活动ID，关联到具体的营销活动
- `source_id`: 来源渠道ID，记录线索获取的具体渠道
- `medium_id`: 媒介ID，记录线索通过何种媒介获取
- `user_id`: 销售人员ID，关联到负责该线索的销售人员
- `team_id`: 销售团队ID，关联到负责该线索的销售团队
- `stage_id`: 销售阶段ID，标识线索当前所处的销售阶段
- `partner_id`: 联系人ID，关联到具体的联系人信息
- `country_id`/`state_id`: 地理位置信息
- `lost_reason_id`: 丢失原因ID，记录线索失败转化的具体原因
- `probability`: 赢单概率，记录该线索最终赢单的预估概率
- `day_open`/`day_close`: 分配天数和关闭天数，用于销售效率分析

#### 2.1.2 销售团队 (crm_team)

**功能描述**：管理销售团队信息，包括团队配置、目标设置和工作流程。

**主要字段**：
- `id`: 主键ID，唯一标识每一个销售团队
- `sequence`: 顺序号，定义团队在列表中的显示顺序
- `company_id`: 公司ID，关联到团队所属的公司
- `user_id`: 团队负责人用户ID，标识团队的领导者

#### 2.1.3 团队成员 (crm_team_member)

**功能描述**：管理销售团队成员信息，包括人员分配、容量限制和工作偏好。

**主要字段**：
- `id`: 主键ID，唯一标识每一条团队成员记录
- `crm_team_id`: CRM团队ID，关联到成员所属的销售团队
- `user_id`: 销售人员用户ID，关联到团队中的具体销售人员用户

### 2.2 销售流程控制

#### 2.2.1 销售阶段 (crm_stage)

**功能描述**：定义CRM销售流程中的各个阶段，管理线索和商机的生命周期。

**主要字段**：
- `id`: 主键ID，唯一标识每一个CRM阶段
- `sequence`: 顺序号，定义阶段在销售流程中的显示顺序
- `rotting_threshold_days`: 腐烂阈值天数，定义线索在该阶段停留超过多少天会被标记为需要跟进
- `color`: 颜色值，定义阶段在界面上显示的颜色代码

#### 2.2.2 丢失原因 (crm_lost_reason)

**功能描述**：存储商机丢失的原因分类，用于分析销售漏斗和优化销售流程。

**主要字段**：
- `id`: 主键ID，唯一标识商机丢失原因记录
- `name`: 丢失原因名称，存储多语言的丢失原因描述
- `active`: 是否激活，控制该丢失原因是否可用

### 2.3 分类与标记

#### 2.3.1 标签 (crm_tag)

**功能描述**：管理CRM系统中的标签信息，用于对线索、商机等CRM对象进行分类和标记。

**主要字段**：
- `id`: 主键ID，唯一标识每一个标签
- `color`: 颜色值，定义标签在界面上显示的颜色代码
- `name`: 标签名称，存储标签的多语言名称，使用JSON格式支持国际化

#### 2.3.2 标签关联 (crm_tagrel)

**功能描述**：管理CRM对象与标签之间的关联关系，支持多对多的数据关联。

### 2.4 数据分析与智能化

#### 2.4.1 线索评分频率 (crm_lead_scoring_frequency)

**功能描述**：存储线索评分频率数据，用于分析不同变量值对线索转化结果的影响频率。

**主要字段**：
- `id`: 主键ID，唯一标识线索评分频率记录
- `team_id`: 销售团队ID，关联到特定的销售团队
- `variable_name`: 变量名，标识分析的字段变量，如行业、地区、来源等

#### 2.4.2 周期性收入计划 (crm_recurring_plan)

**功能描述**：存储CRM系统中的周期性收入计划配置，用于管理和预测客户的定期收入。

**主要字段**：
- `id`: 主键ID，唯一标识周期性收入计划记录
- `number_of_months`: 月份数量，定义周期性计划的持续月份数
- `sequence`: 排序序号，用于控制周期性计划在界面上的显示顺序

### 2.5 外部集成与数据增强

#### 2.5.1 IAP线索职位 (crm_iap_lead_role)

**功能描述**：存储通过IAP模块获取的线索中联系人的职位信息，用于对线索联系人进行职位分类和筛选。

**主要字段**：
- `id`: 职位ID，系统自动生成的主键
- `color`: 颜色索引，用于在界面中展示不同职位类型时使用的颜色标识

#### 2.5.2 IAP线索行业 (crm_iap_lead_industry)

**功能描述**：管理IAP模块中使用的行业分类标准，用于线索的行业属性分类。

#### 2.5.3 IAP线索挖掘请求 (crm_iap_lead_mining_request)

**功能描述**：管理通过IAP模块发起的线索挖掘请求，包括请求参数、结果状态等信息。

### 2.6 关联表实体

#### 2.6.1 线索与丢失线索关联 (crm_lead_crm_lead_lost_rel)

**功能描述**：存储线索与丢失线索记录之间的多对多关联关系，定义哪些线索关联到特定的丢失原因记录。

**主要字段**：
- `crm_lead_lost_id`: 丢失线索记录ID，关联到线索丢失原因的记录
- `crm_lead_id`: 线索ID，关联到被标记为丢失的销售线索记录

#### 2.6.2 线索与网站访客关联 (crm_lead_website_visitor_rel)

**功能描述**：存储CRM线索与网站访客之间的多对多关联关系，用于跟踪线上访客与CRM线索的对应关系。

**主要字段**：
- `crm_lead_id`: CRM线索ID，关联到具体的CRM线索记录
- `website_visitor_id`: 网站访客ID，关联到具体的网站访客记录

#### 2.6.3 线索与转化关联 (crm_lead_crm_lead2opportunity_partner_rel)

**功能描述**：记录线索转化为商机的关联关系，用于跟踪线索转化历史。

### 2.7 工作流与批量操作

#### 2.7.1 批量线索转化 (crm_lead2opportunity_partner_mass)

**功能描述**：管理批量线索转化为商机的操作记录，支持批量处理多个线索。

#### 2.7.2 批量线索更新 (crm_lead_pls_update)

**功能描述**：管理批量更新线索的操作配置，支持批量修改线索属性。

## 3. 实体关系图

CRM模块中的主要实体关系如下：

1. **核心业务流**：
   - 销售团队(crm_team) → 团队成员(crm_team_member) → 线索(crm_lead)
   - 线索(crm_lead) → 销售阶段(crm_stage)
   - 线索(crm_lead) → 丢失原因(crm_lost_reason)

2. **分类与标记**：
   - 线索(crm_lead) ↔ 标签(crm_tag) (通过crm_tagrel关联)

3. **数据分析**：
   - 销售团队(crm_team) → 线索评分频率(crm_lead_scoring_frequency)
   - 线索(crm_lead) → 周期性收入计划(crm_recurring_plan)

4. **外部集成**：
   - 线索(crm_lead) → IAP线索挖掘请求(crm_iap_lead_mining_request)
   - IAP线索挖掘请求 → IAP线索职位(crm_iap_lead_role)
   - IAP线索挖掘请求 → IAP线索行业(crm_iap_lead_industry)

## 4. 主要业务流程

### 4.1 线索管理流程

1. **线索获取**：通过营销活动、网站访问或IAP线索挖掘等渠道获取线索
2. **线索分配**：根据规则将线索分配给销售团队成员
3. **线索跟进**：销售人员跟进线索，更新线索状态和阶段
4. **线索评分**：系统根据线索属性和行为进行评分，确定优先级
5. **线索转化**：将合格线索转化为商机和客户
6. **分析优化**：基于线索数据进行销售流程分析和优化

### 4.2 销售团队协作流程

1. **团队创建**：建立销售团队，指定团队负责人
2. **成员管理**：添加/移除团队成员，设置成员权限
3. **目标分配**：为团队和个人设定销售目标
4. **工作流配置**：定制团队的销售流程和阶段
5. **绩效监控**：跟踪团队和个人的销售绩效

## 5. 特色功能

1. **线索智能评分**：基于多维度数据自动为线索打分，帮助销售人员优先处理高质量线索
2. **多渠道线索整合**：支持从多个渠道获取线索，并进行统一管理
3. **销售漏斗可视化**：直观展示销售流程中各阶段的线索数量和转化率
4. **数据增强服务**：通过IAP模块对线索数据进行自动补充和增强
5. **团队协作管理**：支持多销售团队协作，合理分配资源和任务
6. **周期性收入预测**：基于客户历史数据预测未来的周期性收入
7. **定制化销售阶段**：可根据企业实际业务需求自定义销售阶段和流程

## 6. 技术实现要点

1. **实体关系设计**：采用TypeORM进行实体映射，支持复杂的关联关系
2. **多语言支持**：通过JSONB类型字段支持多语言内容存储
3. **软删除机制**：通过active字段实现记录的软删除功能
4. **索引优化**：对常用查询字段建立索引，提高查询性能
5. **数据隔离**：通过team_id等字段实现数据的团队级隔离

## 7. 典型应用场景

### 7.1 B2B销售管理
- 跟踪企业客户的销售周期
- 管理销售团队和个人绩效
- 分析销售漏斗和转化率

### 7.2 市场营销活动效果追踪
- 将营销活动与线索获取关联
- 分析不同营销渠道的效果
- 优化营销投资回报率

### 7.3 客户生命周期管理
- 从潜在客户到现有客户的全生命周期管理
- 预测客户价值和流失风险
- 制定客户维护和发展策略

### 7.4 销售预测与报表
- 基于历史数据预测未来销售
- 生成各类销售报表和分析图表
- 支持管理层决策

## 8. 扩展与集成

1. **与营销自动化系统集成**：自动同步营销活动数据和线索信息
2. **与ERP其他模块集成**：与销售订单、客户管理等模块无缝对接
3. **与外部通讯工具集成**：支持与邮件、电话系统等通讯工具集成
4. **自定义字段扩展**：支持添加自定义字段以满足特定业务需求
5. **API接口支持**：提供丰富的API接口，支持第三方系统集成

## 9. 数据安全与权限

1. **基于角色的权限控制**：通过用户角色和权限设置控制数据访问
2. **团队数据隔离**：不同销售团队只能访问自己的线索和客户数据
3. **操作审计日志**：记录关键操作的审计日志，确保数据安全
4. **数据加密**：敏感客户数据的加密存储和传输
5. **合规性支持**：支持数据隐私保护和合规性要求

## 10. 性能优化建议

1. **定期数据清理**：清理过时的线索和历史数据
2. **索引优化**：根据查询模式优化数据库索引
3. **查询优化**：优化复杂查询，避免全表扫描
4. **缓存策略**：对频繁访问的数据实施缓存
5. **批量处理**：对批量操作进行性能优化，避免频繁数据库交互

---

本文档详细描述了CRM模块的实体结构、功能特性和业务流程，为系统开发、维护和使用提供参考。如需进一步了解特定功能或实体关系的详细信息，请参考相关技术文档或代码实现。