# 项目管理(Project)模块产品文档

## 1. 模块概述

项目管理(Project)模块是系统中用于全面管理项目生命周期的核心组件，提供完整的项目规划、任务分配、进度跟踪、团队协作和资源管理功能。该模块支持从项目创建、任务分解、资源分配到项目完成的全流程管理，并提供灵活的配置选项以适应不同类型的项目需求。

主要功能亮点：
- 完整的项目生命周期管理
- 灵活的任务分解与分配
- 项目里程碑设置与跟踪
- 团队协作与资源管理
- 任务依赖关系配置
- 任务标签与分类系统
- 项目模板与快速创建
- 项目共享与外部协作
- 重复任务自动化管理

## 2. 实体表结构与功能详解

### 2.1 项目管理核心实体

#### 2.1.1 项目主表 (project_project)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 项目主键ID |
| name | jsonb | 项目名称(多语言支持) |
| partner_id | int | 客户ID |
| company_id | int | 公司ID |
| user_id | int | 项目经理ID |
| stage_id | int | 项目阶段ID |
| date_start | datetime | 项目开始日期 |
| date | datetime | 项目到期日期 |
| description | varchar | 项目描述 |
| active | boolean | 活跃状态 |
| allow_task_dependencies | boolean | 允许任务依赖 |
| allow_milestones | boolean | 允许里程碑 |
| allow_recurring_tasks | boolean | 允许重复任务 |
| is_template | boolean | 模板标记 |
| allow_billable | boolean | 允许计费 |

**功能说明**：项目主表是整个模块的核心，存储项目的基本信息、配置选项和状态。支持设置项目的各种功能开关，如任务依赖、里程碑、重复任务等，并可配置为模板供其他项目使用。同时支持与财务系统集成，通过allow_billable字段控制是否可用于计费。

#### 2.1.2 项目阶段表 (project_project_stage)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 阶段主键ID |
| name | jsonb | 阶段名称(多语言支持) |
| sequence | int | 排序序号 |
| color | int | 颜色标识 |
| active | boolean | 活跃状态 |
| mail_template_id | int | 邮件模板ID |

**功能说明**：定义项目的生命周期阶段，如"规划中"、"进行中"、"已完成"等。每个阶段可以配置独立的颜色标识和通知邮件模板，支持自定义项目流程。

### 2.2 任务管理相关实体

#### 2.2.1 任务表 (project_task)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 任务主键ID |
| name | varchar | 任务标题 |
| project_id | int | 所属项目ID |
| partner_id | int | 客户ID |
| stage_id | int | 任务阶段ID |
| parent_id | int | 父任务ID |
| milestone_id | int | 关联里程碑ID |
| recurrence_id | int | 重复设置ID |
| priority | varchar | 优先级 |
| state | varchar | 状态 |
| color | int | 颜色索引 |

**功能说明**：存储项目中的具体任务信息，支持任务层级结构(通过parent_id)、优先级管理、状态跟踪等。可关联到特定的里程碑，并支持任务重复设置。

#### 2.2.2 任务类型表 (project_task_type)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 类型主键ID |
| sequence | int | 排序序号 |
| color | int | 颜色标识 |
| user_id | int | 阶段负责人ID |
| mail_template_id | int | 邮件模板ID |
| rating_template_id | int | 评价模板ID |
| rotting_threshold_days | int | 任务老化天数阈值 |

**功能说明**：定义任务的不同类型或状态阶段，如"待处理"、"进行中"、"已完成"等。支持为每种类型设置不同的负责人、邮件通知模板和评价模板，并可配置任务老化提醒。

#### 2.2.3 任务重复设置表 (project_task_recurrence)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 设置主键ID |
| repeat_interval | int | 重复间隔 |
| repeat_unit | varchar | 重复单位(如days,weeks,months) |
| repeat_type | varchar | 重复类型 |
| repeat_until | datetime | 结束日期 |

**功能说明**：配置任务的自动重复规则，支持按天、周、月等不同时间单位设置重复间隔，并可指定重复结束条件。

### 2.3 项目里程碑与进度管理

#### 2.3.1 项目里程碑表 (project_milestone)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 里程碑主键ID |
| name | varchar | 里程碑名称 |
| project_id | int | 所属项目ID |
| deadline | datetime | 截止日期 |
| reached_date | datetime | 达成日期 |
| is_reached | boolean | 是否已达成 |
| sequence | int | 排序序号 |

**功能说明**：用于设置和跟踪项目的关键里程碑，记录每个里程碑的截止日期和实际达成日期，帮助项目管理者监控项目进度。

#### 2.3.2 项目更新表 (project_update)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 更新记录ID |
| project_id | int | 所属项目ID |
| user_id | int | 更新用户ID |
| content | varchar | 更新内容 |
| create_date | datetime | 创建时间 |

**功能说明**：记录项目的重要更新和状态变更历史，提供项目活动日志。

### 2.4 协作与权限管理

#### 2.4.1 项目协作者表 (project_collaborator)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 协作者ID |
| project_id | int | 项目ID |
| partner_id | int | 协作者(合作伙伴)ID |
| limited_access | boolean | 有限访问权限 |

**功能说明**：管理项目的外部协作者，可添加客户或合作伙伴作为项目协作者，并可控制其访问权限范围。

#### 2.4.2 项目角色表 (project_role)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 角色ID |
| name | jsonb | 角色名称(多语言支持) |
| color | int | 颜色标识 |
| active | boolean | 活跃状态 |
| sequence | int | 排序序号 |

**功能说明**：定义项目中的不同角色，用于任务分配和权限管理。

#### 2.4.3 任务用户关系表 (project_task_user_rel)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 关系ID |
| task_id | int | 任务ID |
| user_id | int | 用户ID |
| stage_id | int | 任务阶段ID |

**功能说明**：管理任务与用户之间的关联关系，记录任务的负责人、参与者等，并可记录任务对特定用户的状态。

### 2.5 标签与分类系统

#### 2.5.1 项目标签表 (project_tags)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 标签ID |
| name | jsonb | 标签名称(多语言支持) |
| color | int | 颜色标识 |

**功能说明**：定义用于分类和筛选项目的标签系统，支持多语言显示和颜色标识。

#### 2.5.2 项目标签关系表 (project_projecttagsrel)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 关系ID |
| project_id | int | 项目ID |
| tag_id | int | 标签ID |

**功能说明**：关联项目与标签，支持一个项目应用多个标签。

#### 2.5.3 任务标签关系表 (project_tagsprojecttaskrel)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 关系ID |
| task_id | int | 任务ID |
| tag_id | int | 标签ID |

**功能说明**：关联任务与标签，支持为任务添加多个分类标签。

### 2.6 项目模板与共享

#### 2.6.1 模板创建向导表 (project_templatecreatewizard)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 向导ID |
| name | varchar | 模板名称 |
| project_id | int | 源项目ID |
| include_tasks | boolean | 包含任务 |
| include_milestones | boolean | 包含里程碑 |

**功能说明**：用于从现有项目创建新模板的向导配置，可选择包含任务和里程碑等内容。

#### 2.6.2 模板角色用户映射表 (project_templateroletousersmap)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 映射ID |
| role_id | int | 角色ID |
| user_id | int | 用户ID |

**功能说明**：在模板应用时，将模板中的角色映射到实际用户，便于快速分配任务。

#### 2.6.3 项目共享向导表 (project_sharewizard)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 向导ID |
| project_id | int | 项目ID |
| access_token | varchar | 访问令牌 |
| share_with_partners | boolean | 与合作伙伴共享 |

**功能说明**：配置项目共享的向导工具，支持生成访问令牌和选择共享对象。

### 2.7 工具向导实体

#### 2.7.1 任务类型删除向导表 (project_tasktypedeletewizard)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 向导ID |
| task_type_id | int | 任务类型ID |
| dest_task_type_id | int | 目标任务类型ID |

**功能说明**：删除任务类型时用于处理现有任务的迁移配置，可指定任务转移到的目标类型。

#### 2.7.2 项目阶段删除向导表 (project_projectstagedeletewizard)

| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | int | 向导ID |
| project_stage_id | int | 项目阶段ID |
| dest_project_stage_id | int | 目标项目阶段ID |

**功能说明**：删除项目阶段时用于处理相关项目的迁移配置，确保项目数据完整性。

## 3. 实体关系图

```
项目管理模块实体关系

+------------------+       +------------------+       +------------------+
| project_project  |<------| project_milestone|<------| project_task     |
+------------------+       +------------------+       +------------------+
        |                        |                         |
        |                        |                         |
        v                        v                         v
+------------------+       +------------------+       +------------------+
|project_projectstage|<--->| project_update   |       |project_task_type |
+------------------+       +------------------+       +------------------+
                                                          |
                                                          |
                                                          v
+------------------+       +------------------+       +------------------+
| project_tags     |<------|project_tagsprojecttaskrel|<--|project_taskrecurrence|
+------------------+       +------------------+       +------------------+
        |
        |
        v
+------------------+
|project_projecttagsrel|
+------------------+

协作与共享关系

+------------------+       +------------------+       +------------------+
| project_role     |<------| project_collaborator|<--->| project_task_user_rel|
+------------------+       +------------------+       +------------------+
        |
        |
        v
+------------------+
|templateroletousersmap|
+------------------+
```

## 4. 主要业务流程

### 4.1 项目创建与配置流程

1. **项目初始化**：创建新项目，设置基本信息(名称、描述、日期等)
2. **项目配置**：设置项目经理、客户信息、项目阶段
3. **功能开关**：配置任务依赖、里程碑、重复任务等功能选项
4. **项目模板化**：可选保存为模板供后续使用

### 4.2 任务管理流程

1. **任务创建**：在项目中创建任务，设置标题、描述、优先级等
2. **任务分解**：支持创建子任务，建立任务层级结构
3. **任务分配**：将任务分配给团队成员
4. **状态跟踪**：任务在不同阶段间流转
5. **里程碑关联**：将任务关联到相关里程碑
6. **重复配置**：设置定期重复任务规则

### 4.3 团队协作流程

1. **协作者管理**：添加内部团队成员和外部协作者
2. **权限控制**：设置不同角色和访问权限
3. **任务通知**：配置任务状态变更的邮件通知
4. **项目共享**：通过访问令牌与外部用户共享项目

### 4.4 项目进度监控流程

1. **里程碑跟踪**：监控关键里程碑的达成状态
2. **任务完成统计**：跟踪任务完成率和进度
3. **项目阶段变更**：管理项目在不同生命周期阶段间的转换
4. **更新记录**：记录项目的重要状态更新

## 5. 特色功能

### 5.1 灵活的项目配置

- **功能模块化**：可按需启用/禁用任务依赖、里程碑、重复任务等功能
- **自定义字段**：通过task_properties_definition配置任务的自定义属性
- **多语言支持**：项目名称、标签等关键信息支持多语言显示

### 5.2 强大的任务管理

- **任务层级结构**：支持无限层级的任务分解
- **任务依赖关系**：可设置任务间的前置依赖，实现自动工作流
- **智能重复任务**：支持按多种规则配置任务自动重复
- **任务老化提醒**：可设置任务长时间未处理的自动提醒

### 5.3 全面的协作功能

- **内外协作**：支持内部团队和外部客户的协作管理
- **权限精细控制**：通过角色系统和limited_access字段控制访问范围
- **项目共享**：生成安全访问令牌，便于外部访问特定项目
- **任务评价**：支持任务完成后的评价和反馈

### 5.4 高效的模板系统

- **项目模板**：可将现有项目保存为模板快速创建新项目
- **角色映射**：模板应用时支持将模板角色映射到实际用户
- **选择性复制**：可选择是否包含任务、里程碑等内容

## 6. 技术实现要点

### 6.1 数据模型设计

- 使用外键关联确保数据完整性
- 多语言字段使用jsonb类型存储
- 任务状态、项目阶段采用可配置的枚举值
- 使用关联表处理多对多关系

### 6.2 权限与安全

- 通过access_token实现安全的外部访问
- limited_access字段控制协作者权限范围
- 支持不同级别的数据访问控制

### 6.3 配置化设计

- 大部分功能可通过配置开启/关闭
- 任务属性、标签等支持自定义配置
- 工作流程可通过阶段配置灵活调整

## 7. 总结

项目管理模块提供了全面、灵活的项目生命周期管理功能，通过合理的实体设计和关联关系，支持从项目创建、任务分解、团队协作到进度监控的完整流程。该模块特别强调了任务管理的灵活性、团队协作的便捷性以及配置的可扩展性，适合各种规模和类型的项目管理需求。

通过合理运用项目模板、任务依赖、里程碑跟踪等功能，团队可以更高效地规划和执行项目，提高项目成功率和团队协作效率。

本文档详细描述了项目管理模块的实体结构、功能特性和业务流程，为系统开发、维护和使用提供参考。如需进一步了解特定功能或实体关系的详细信息，请参考相关技术文档或代码实现。